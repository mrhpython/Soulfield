# Spec: Soulfield OS GUI (Local‑First Desktop Mock)

> **Purpose**
> Create a single‑page static GUI mock (HTML/CSS/JS) that we can regenerate safely from a spec. No build tool, no framework. All files are written with `printf` and directories with `mkdir` to stay inside the job whitelist. This establishes the plumbing we’ll later swap into Tauri/Electron/React.

---

## SRD — Requirements & Outcomes

### Users

* Single local operator (Ubuntu). Backend available at `http://127.0.0.1:8790`.

### Goals

* Visual shell for Soulfield: nav rail, status bar, tabbed panels.
* Tabs scaffolded: **Projects, Sessions, Agents, Commands, Memory, Specs, Logs, Settings, MCP**.
* Minimal interactivity: health ping indicator; Commands demo posting to `/chat`.

### Constraints

* Local‑first, file:// preview is fine (no bundlers).
* Keep commands to the whitelist: `echo`, `ls`, `cat`, `head`, `mkdir`, `touch`, `printf`.
* Only use redirection with `printf` (our guard allows `>`, `<`, `;` for `printf` only).

### Success Criteria

* `~/soulfield/soulfield-gui/{index.html,styles.css,app.js}` exist.
* Opening `index.html` shows a styled dark UI. Nav items switch panels.
* Status dot reflects `/health` (green/gray).
* Commands tab can send a prompt and show the backend `.output`.

---

## Information Architecture

* **Shell**: left nav rail (collapsible later), top status bar, right content panel.
* **Panels**

  * **Projects**: cards grid (placeholder data).
  * **Sessions**: split view (list + details pane) — mock content for now.
  * **Agents**: directory cards (placeholder).
  * **Commands**: textarea + Send (POST `/chat`).
  * **Memory**: simple table (placeholder).
  * **Specs**: list of spec files (placeholder).
  * **Logs**: list/table (placeholder).
  * **Settings**: key/value table (placeholder).
  * **MCP**: server list (placeholder).

---

## Run (approved)

> **Note**: Each line is a standalone command (no pipes/heredocs). Use `#apply` to execute; use `--dry` to preview.

```bash
# seed README and folders
echo "seed README+TODOs and GUI files"
mkdir -p /home/michael/soulfield/soulfield-gui/src/{shell,tabs,services,components,utils}
printf '%s\n' "# Soulfield GUI Mock" "Generated by Agent OS spec. Edit spec, re-apply to iterate." > /home/michael/soulfield/soulfield-gui/README.md

# styles (dark theme + utilities)
printf '%s\n' \
':root{--bg:#0f1115;--panel:#161a22;--rail:#0c0f14;--text:#e5e7eb;--muted:#9aa3b2;--green:#34d399;--accent:#4f46e5;--card:#1b2130;--border:#232a38}' \
'*{box-sizing:border-box}html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}' \
'body{background:var(--bg);color:var(--text)}' \
'.app{display:grid;grid-template-columns:240px 1fr;height:100vh}' \
'.nav{background:var(--rail);padding:16px;border-right:1px solid var(--border)}' \
'.brand{font-weight:700;margin-bottom:12px;letter-spacing:.4px}' \
'.menu{list-style:none;padding:0;margin:8px 0 0 0}' \
'.menu li{padding:10px 12px;border-radius:10px;color:var(--muted);cursor:default}' \
'.menu li.active{background:var(--panel);color:var(--text)}' \
'.content{display:flex;flex-direction:column}' \
'.statusbar{display:flex;gap:10px;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border);background:var(--panel)}' \
'.dot{width:9px;height:9px;border-radius:50%;display:inline-block;background:#666}' \
'.badge{margin-left:auto;background:#223;padding:6px 10px;border-radius:999px;color:#c7cff9;border:1px solid #334}' \
'.panel{padding:16px}' \
'.panel-head{display:flex;align-items:center;gap:12px;margin-bottom:12px}' \
'.panel-head h1{margin:0;font-size:18px}' \
'.btn{margin-left:auto;background:var(--accent);color:#fff;border:none;border-radius:10px;padding:8px 12px;cursor:default}' \
'.card-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}' \
'.card{background:var(--card);border:1px solid var(--border);padding:12px;border-radius:16px}' \
'.title{font-weight:600;margin-bottom:6px}' \
'.meta{color:var(--muted);font-size:12px}' \
/* utility */ \
'.grid{display:grid;gap:12px}' \
'.split{display:grid;grid-template-columns:360px 1fr;gap:12px}' \
'.list{background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}' \
'.row{padding:12px;border-bottom:1px solid var(--border)}' \
'.row:last-child{border-bottom:none}' \
'.row.active{background:rgba(255,255,255,0.04)}' \
'.table{width:100%;border-collapse:collapse;background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden}' \
'.table th,.table td{padding:10px 12px;border-bottom:1px solid var(--border);text-align:left;font-size:14px}' \
'.kv{display:grid;grid-template-columns:220px 1fr;gap:6px}' \
'.preout{background:var(--card);border:1px solid var(--border);padding:12px;border-radius:12px;margin-top:12px;white-space:pre-wrap}' \
> /home/michael/soulfield/soulfield-gui/styles.css

# app controller (nav switching, health ping, Commands demo, Sessions mock)
printf '%s\n' \
"'use strict';" \
'const $=s=>document.querySelector(s);const $$=s=>Array.from(document.querySelectorAll(s));' \
'async function pingHealth(){try{const r=await fetch("http://127.0.0.1:8790/health");const ok=r.ok;const el=$(".dot");if(el) el.style.background=ok?"var(--green)":"#666";}catch{const el=$(".dot");if(el) el.style.background="#666";}}' \
'async function sendCommand(){const ta=$("#cmdInput"),out=$("#cmdOut");if(!ta||!out) return;const prompt=ta.value.trim();if(!prompt) return;out.textContent="…running";try{const r=await fetch("http://127.0.0.1:8790/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt})});const j=await r.json();out.textContent=j.output??JSON.stringify(j,null,2);}catch(e){out.textContent="error: "+e;}}' \
'function mountProjects(){ $(".panel").innerHTML=$("#tpl-projects").innerHTML; }' \
'function mountSessions(){ const html=["<div class=\\"panel-head\\\"><h1>Sessions</h1></div>","<div class=\\"split\\\">","<div class=\\"left\\\"><div class=\\"list\\\">","<div class=\\"row active\\\"><div class=\\"title\\\">Session #12</div><div class=\\"meta\\\">Applied • 2h ago</div></div>","<div class=\\"row\\\"><div class=\\"title\\\">Session #11</div><div class=\\"meta\\\">Draft • 6h ago</div></div>","<div class=\\"row\\\"><div class=\\"title\\\">Session #10</div><div class=\\"meta\\\">Failed • 1d ago</div></div>","</div></div>","<div class=\\"right\\\"><div class=\\"card\\\"><div class=\\"title\\\">Session #12</div><div class=\\"meta\\\">id: s-12 • tag: #apply • cost: 13¢</div><pre class=\\"preout\\\">!coder-apply --spec 2025-08-28-soulfield-gui --dry</pre></div></div>","</div>"] .join(""); $(".panel").innerHTML=html; }' \
'function mountCommands(){ $(".panel").innerHTML=["<div class=\\"panel-head\\\"><h1>Commands</h1></div>","<div style=\\"display:flex;gap:8px;align-items:flex-start\\\">","<textarea id=\\"cmdInput\\" rows=\\"4\\" style=\\"flex:1;background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px\\" placeholder=\\"Try: !ask In one line, what is Soulfield OS?\\"></textarea>","<button id=\\"sendBtn\\" class=\\"btn\\\">Send</button>","</div>","<pre id=\\"cmdOut\\" class=\\"preout\\\"></pre>"] .join(""); const b=$("#sendBtn"); if(b) b.onclick=sendCommand; }' \
'function mountAgents(){ $(".panel").innerHTML=$("#tpl-agents").innerHTML; }' \
'function mountMemory(){ $(".panel").innerHTML=$("#tpl-memory").innerHTML; }' \
'function mountSpecs(){ $(".panel").innerHTML=$("#tpl-specs").innerHTML; }' \
'function mountLogs(){ $(".panel").innerHTML=$("#tpl-logs").innerHTML; }' \
'function mountSettings(){ $(".panel").innerHTML=$("#tpl-settings").innerHTML; }' \
'function mountMCP(){ $(".panel").innerHTML=$("#tpl-mcp").innerHTML; }' \
'function navSetup(){ const items=$$(".menu li"); items.forEach(li=>li.onclick=()=>{ items.forEach(x=>x.classList.remove("active")); li.classList.add("active"); const name=li.textContent.trim(); if(name==="Projects") return mountProjects(); if(name==="Sessions") return mountSessions(); if(name==="Agents") return mountAgents(); if(name==="Commands") return mountCommands(); if(name==="Memory") return mountMemory(); if(name==="Specs") return mountSpecs(); if(name==="Logs") return mountLogs(); if(name==="Settings") return mountSettings(); if(name==="MCP") return mountMCP(); }); }' \
'window.addEventListener("DOMContentLoaded",()=>{ pingHealth(); setInterval(pingHealth,4000); navSetup(); });' \
> /home/michael/soulfield/soulfield-gui/app.js

# index.html with templates for all tabs
printf '%s\n' \
'<!doctype html>' \
'<html lang="en">' \
'<head>' \
'  <meta charset="utf-8" />' \
'  <meta name="viewport" content="width=device-width,initial-scale=1" />' \
'  <title>Soulfield OS GUI — Mock</title>' \
'  <link rel="stylesheet" href="styles.css" />' \
'</head>' \
'<body>' \
'  <div class="app">' \
'    <aside class="nav">' \
'      <div class="brand">Soulfield OS</div>' \
'      <ul class="menu">' \
'        <li class="active">Projects</li>' \
'        <li>Sessions</li>' \
'        <li>Agents</li>' \
'        <li>Commands</li>' \
'        <li>Memory</li>' \
'        <li>Specs</li>' \
'        <li>Logs</li>' \
'        <li>Settings</li>' \
'        <li>MCP</li>' \
'      </ul>' \
'    </aside>' \
'    <main class="content">' \
'      <header class="statusbar">' \
'        <span class="dot"></span> Connected: 8790' \
'        <span class="badge">TruthLens: Active</span>' \
'      </header>' \
'      <section class="panel">' \
'        <!-- Default content (Projects) -->' \
'        <template id="tpl-projects">' \
'          <div class="panel-head"><h1>Projects</h1><button class="btn">+ New</button></div>' \
'          <div class="card-list">' \
'            <div class="card"><div class="title">my-app</div><div class="meta">3 sessions · last: 2h ago</div></div>' \
'            <div class="card"><div class="title">data-pipeline</div><div class="meta">8 sessions · last: 10m ago</div></div>' \
'          </div>' \
'        </template>' \
'        <div class="panel-head"><h1>Projects</h1><button class="btn">+ New</button></div>' \
'        <div class="card-list">' \
'          <div class="card"><div class="title">my-app</div><div class="meta">3 sessions · last: 2h ago</div></div>' \
'          <div class="card"><div class="title">data-pipeline</div><div class="meta">8 sessions · last: 10m ago</div></div>' \
'        </div>' \
'      </section>' \
'    </main>' \
'  </div>' \
'  <!-- Panel templates for other tabs -->' \
'  <template id="tpl-agents">' \
'    <div class="panel-head"><h1>Agents</h1></div>' \
'    <div class="card-list">' \
'      <div class="card"><div class="title">Spec Planner</div><div class="meta">claude-opus</div></div>' \
'      <div class="card"><div class="title">Coder</div><div class="meta">apply/dry</div></div>' \
'      <div class="card"><div class="title">Retriever</div><div class="meta">RAG/notes</div></div>' \
'    </div>' \
'  </template>' \
'  <template id="tpl-memory">' \
'    <div class="panel-head"><h1>Memory</h1></div>' \
'    <table class="table">' \
'      <thead><tr><th>Key</th><th>Value</th><th>Updated</th></tr></thead>' \
'      <tbody>' \
'        <tr><td>golden.goal</td><td>Ship GUI mock</td><td>today</td></tr>' \
'        <tr><td>pref.model</td><td>claude-opus-4-1</td><td>today</td></tr>' \
'      </tbody>' \
'    </table>' \
'  </template>' \
'  <template id="tpl-specs">' \
'    <div class="panel-head"><h1>Specs</h1></div>' \
'    <div class="list">' \
'      <div class="row"><div class="title">2025-08-28-soulfield-gui</div><div class="meta">/home/michael/soulfield/.agent-os/specs/…</div></div>' \
'      <div class="row"><div class="title">research-pipeline</div><div class="meta">/specs/research/…</div></div>' \
'    </div>' \
'  </template>' \
'  <template id="tpl-logs">' \
'    <div class="panel-head"><h1>Logs</h1></div>' \
'    <div class="list">' \
'      <div class="row"><div class="title">run #1756401637317</div><div class="meta">ok • 27 cmds</div></div>' \
'      <div class="row"><div class="title">run #175639421757</div><div class="meta">ok • 23 cmds</div></div>' \
'    </div>' \
'  </template>' \
'  <template id="tpl-settings">' \
'    <div class="panel-head"><h1>Settings</h1></div>' \
'    <div class="kv">' \
'      <div class="meta">Model</div><div>claude-opus-4-1-20250805</div>' \
'      <div class="meta">Port</div><div>8790</div>' \
'      <div class="meta">TruthLens</div><div>Active</div>' \
'    </div>' \
'  </template>' \
'  <template id="tpl-mcp">' \
'    <div class="panel-head"><h1>MCP Servers</h1></div>' \
'    <div class="list">' \
'      <div class="row"><div class="title">FS (ro)</div><div class="meta">http://127.0.0.1:8790/mcp/tools</div></div>' \
'      <div class="row"><div class="title">Rerank</div><div class="meta">local</div></div>' \
'    </div>' \
'  </template>' \
'  <script src="app.js"></script>' \
'</body>' \
'</html>' \
> /home/michael/soulfield/soulfield-gui/index.html
```

---

## Usage

* **Preview (dry)**

  ```bash
  curl -s http://127.0.0.1:8790/chat \
    -H 'Content-Type: application/json' \
    -d '{"prompt":"!coder-apply --spec 2025-08-28-soulfield-gui --dry"}' \
  | jq -r .output
  ```

* **Apply**

  ```bash
  curl -s http://127.0.0.1:8790/chat \
    -H 'Content-Type: application/json' \
    -d '{"prompt":"!coder-apply --spec 2025-08-28-soulfield-gui #apply"}' \
  | jq -r .output
  ```

* **Open**

  ```bash
  xdg-open ~/soulfield/soulfield-gui/index.html
  ```

---

## Notes / Next

* Replace static placeholders with real data:

  * Projects from workspace, Sessions from `!session-list`, Logs from runs dir.
* Promote to Tauri (local window) with same HTML/CSS/JS.
* Add TruthLens indicators per message, token/cost meters, MCP tool manager.

